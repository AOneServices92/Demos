Bridge.assembly("PhaserDemo",function(){"use strict";Bridge.define("PhaserDemo.App",{main:function(){PhaserDemo.App.InitEventHandlers();PhaserDemo.App.SwitchGameTo(1)},statics:{fields:{_game:null,_isRun:!1},methods:{InitEventHandlers:function(){for(var index,btns=System.Array.init([document.getElementById("sample1Btn"),document.getElementById("sample2Btn"),document.getElementById("sample3Btn")],HTMLElement),i=0;i<btns.length;i=i+1|0)index={v:i},btns[System.Array.index(i,btns)].onclick=function($me,index){return function(){return PhaserDemo.App.SwitchGameTo(index.v+1|0),null}}(this,index)},SwitchGameTo:function(number){PhaserDemo.App._isRun&&(PhaserDemo.App._game.destroy(),PhaserDemo.App._game=null,PhaserDemo.App._isRun=!1);PhaserDemo.App._game=PhaserDemo.App.RunGame(number);PhaserDemo.App._isRun=!0},RunGame:function(number){var state1,state2,state3;switch(number){case 1:return state1=new PhaserDemo.Games.GameState1,new Phaser.Game(800,600,Phaser.AUTO,"phaserRoot",state1);case 2:return state2=new PhaserDemo.Games.GameState2,new Phaser.Game(800,600,Phaser.AUTO,"phaserRoot",state2);case 3:return state3=new PhaserDemo.Games.GameState3,new Phaser.Game(800,600,Phaser.AUTO,"phaserRoot",state3);default:throw new System.ArgumentOutOfRangeException("number");}}}}});Bridge.define("PhaserDemo.Games.AbstractGameState",{inherits:[Phaser.State],methods:{preload:function(){},create:function(){},update:function(){},render:function(){}}});Bridge.define("PhaserDemo.Games.GameState1",{inherits:[PhaserDemo.Games.AbstractGameState],fields:{_player:null,_aliens:null,_bullets:null,_bulletTime:0,_cursors:null,_fireButton:null,_explosions:null,_starfield:null,_score:0,_scoreString:null,_scoreText:null,_lives:null,_enemyBullets:null,_firingTimer:0,_stateText:null,_livingEnemies:null},ctors:{init:function(){this._scoreString="";this._livingEnemies=new Array(0)}},methods:{preload:function(){this.game.load.crossOrigin=!0;this.game.load.image("bullet","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/bullet.png");this.game.load.image("enemyBullet","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/enemy-bullet.png");this.game.load.spritesheet("invader","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/invader32x32x4.png",32,32);this.game.load.image("ship","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/player.png");this.game.load.spritesheet("kaboom","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/explode.png",128,128);this.game.load.image("starfield","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/invaders/starfield.png");this.game.load.image("background","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/games/starstruck/background2.png")},create:function(){var i,ship;for(this.game.physics.startSystem(Phaser.Physics.ARCADE),this._starfield=this.game.add.tileSprite(0,0,800,600,"starfield"),this._bullets=this.game.add.group(),this._bullets.enableBody=!0,this._bullets.physicsBodyType=Phaser.Physics.ARCADE,this._bullets.createMultiple(30,"bullet"),this._bullets.setAll("anchor.x",.5),this._bullets.setAll("anchor.y",1),this._bullets.setAll("outOfBoundsKill",!0),this._bullets.setAll("checkWorldBounds",!0),this._enemyBullets=this.game.add.group(),this._enemyBullets.enableBody=!0,this._enemyBullets.physicsBodyType=Phaser.Physics.ARCADE,this._enemyBullets.createMultiple(30,"enemyBullet"),this._enemyBullets.setAll("anchor.x",.5),this._enemyBullets.setAll("anchor.y",1),this._enemyBullets.setAll("outOfBoundsKill",!0),this._enemyBullets.setAll("checkWorldBounds",!0),this._player=this.game.add.sprite(400,500,"ship"),this._player.anchor.setTo(.5,.5),this.game.physics.enable(this._player,Phaser.Physics.ARCADE),this._aliens=this.game.add.group(),this._aliens.enableBody=!0,this._aliens.physicsBodyType=Phaser.Physics.ARCADE,this.CreateAliens(),this._scoreString="Score : ",this._scoreText=this.game.add.text(10,10,(this._scoreString||"")+System.Double.format(this._score),{font:"34px Arial",fill:"#fff"}),this._lives=this.game.add.group(),this.game.add.text(this.game.world.width-100,10,"Lives : ",{font:"34px Arial",fill:"#fff"}),this._stateText=this.game.add.text(this.game.world.centerX,this.game.world.centerY," ",{font:"84px Arial",fill:"#fff"}),this._stateText.anchor.setTo(.5,.5),this._stateText.visible=!1,i=0;i<3;i=i+1|0)ship=Bridge.cast(this._lives.create(this.game.world.width-100+Bridge.Int.mul(30,i),60,"ship"),Phaser.Sprite),ship.anchor.setTo(.5,.5),ship.angle=90,ship.alpha=.4;this._explosions=this.game.add.group();this._explosions.createMultiple(30,"kaboom");this._explosions.forEach(Bridge.fn.cacheBind(this,this.SetupInvader),this);this._cursors=this.game.input.keyboard.createCursorKeys();this._fireButton=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},CreateAliens:function(){for(var x,alien,tween,y=0;y<4;y=y+1|0)for(x=0;x<10;x=x+1|0)alien=Bridge.cast(this._aliens.create(Bridge.Int.mul(x,48),Bridge.Int.mul(y,50),"invader"),Phaser.Sprite),alien.anchor.setTo(.5,.5),alien.animations.add("fly",System.Array.init([0,1,2,3],System.Double),20,!0),alien.play("fly"),alien.body.moves=!1;this._aliens.x=100;this._aliens.y=50;tween=this.game.add.tween(this._aliens).to({x:200},2e3,Phaser.Easing.Linear.None,!0,0,1e3,!0);tween.onLoop.add(Bridge.fn.cacheBind(this,this.Descend),this)},SetupInvader:function(invader){invader.anchor.x=.5;invader.anchor.y=.5;invader.animations.add("kaboom")},Descend:function(){this._aliens.y+=10},update:function(){var $t,playerBody;$t=this._starfield.tilePosition;$t.y+=2;this._player.alive&&(playerBody=this._player.body,playerBody.velocity.setTo(0,0),this._cursors.left.isDown?playerBody.velocity.x=-200:this._cursors.right.isDown&&(playerBody.velocity.x=200),this._fireButton.isDown&&this.FireBullet(),this.game.time.now>this._firingTimer&&this.EnemyFires(),this.game.physics.arcade.overlap(this._bullets,this._aliens,Bridge.fn.cacheBind(this,this.collisionHandler),null,this),this.game.physics.arcade.overlap(this._enemyBullets,this._player,Bridge.fn.cacheBind(this,this.EnemyHitsPlayer),null,this))},render:function(){},collisionHandler:function(bullet,alien){var alienBody=alien.body,explosion;bullet.kill();alien.kill();this._score+=20;this._scoreText.text=(this._scoreString||"")+System.Double.format(this._score);explosion=Bridge.cast(this._explosions.getFirstExists(!1),Phaser.Sprite);explosion.reset(alienBody.x,alienBody.y);explosion.play("kaboom",30,!1,!0);this._aliens.countLiving()===0&&(this._score+=1e3,this._scoreText.text=(this._scoreString||"")+System.Double.format(this._score),this._enemyBullets.callAll("kill",this),this._stateText.text=" You Won, \n Click to restart",this._stateText.visible=!0,this.game.input.onTap.addOnce(Bridge.fn.cacheBind(this,this.Restart),this))},EnemyHitsPlayer:function(player,bullet){var playerBody=player.body,live,explosion;bullet.kill();live=Bridge.cast(this._lives.getFirstAlive(),Phaser.Sprite);live!=null&&live.kill();explosion=Bridge.cast(this._explosions.getFirstExists(!1),Phaser.Sprite);explosion.reset(playerBody.x,playerBody.y);explosion.play("kaboom",30,!1,!0);this._lives.countLiving()<1&&(player.kill(),this._enemyBullets.callAll("kill",null),this._stateText.text=" GAME OVER \n Click to restart",this._stateText.visible=!0,this.game.input.onTap.addOnce(Bridge.fn.cacheBind(this,this.Restart),this))},EnemyFires:function(){var enemyBullet=Bridge.cast(this._enemyBullets.getFirstExists(!1),Phaser.Sprite);if(this._livingEnemies.length=0,this._aliens.forEachAlive(Bridge.fn.bind(this,function(alien){this._livingEnemies.push(alien)}),null),enemyBullet!=null&&this._livingEnemies.length>0){var random=this.game.rnd.integerInRange(0,this._livingEnemies.length-1),shooter=this._livingEnemies[random],shooterBody=shooter.body;enemyBullet.reset(shooterBody.x,shooterBody.y);this.game.physics.arcade.moveToObject(enemyBullet,this._player,120);this._firingTimer=this.game.time.now+2e3}},FireBullet:function(){var bullet,bulletBody;this.game.time.now>this._bulletTime&&(bullet=Bridge.cast(this._bullets.getFirstExists(!1),Phaser.Sprite),bullet!=null&&(bulletBody=bullet.body,bullet.reset(this._player.x,this._player.y+8),bulletBody.velocity.y=-400,this._bulletTime=this.game.time.now+200))},ResetBullet:function(bullet){bullet.kill()},Restart:function(){this._lives.callAll("revive",null);this._aliens.removeAll();this.CreateAliens();this._player.revive();this._stateText.visible=!1}}});Bridge.define("PhaserDemo.Games.GameState2",{inherits:[PhaserDemo.Games.AbstractGameState],fields:{_bullets:null,_cursors:null,_ship:null},methods:{preload:function(){this.game.load.crossOrigin=!0;this.game.load.image("car","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/sprites/car.png");this.game.load.image("tinycar","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/sprites/tinycar.png")},create:function(){var i,bullet;for(this.game.physics.startSystem(Phaser.Physics.P2JS),this._bullets=this.game.add.group(),i=0;i<10;i=i+1|0)bullet=this._bullets.create(this.game.rnd.integerInRange(200,1700),this.game.rnd.integerInRange(-200,400),"tinycar"),this.game.physics.p2.enable(Bridge.unbox(bullet),!1);this._cursors=this.game.input.keyboard.createCursorKeys();this._ship=this.game.add.sprite(32,this.game.world.height-150,"car");this.game.physics.p2.enable(this._ship)},update:function(){var shipBody=this._ship.body;this._bullets.forEachAlive(Bridge.fn.cacheBind(this,this.MoveBullets),this);this._cursors.left.isDown?shipBody.rotateLeft(100):this._cursors.right.isDown?shipBody.rotateRight(100):shipBody.setZeroRotation();this._cursors.up.isDown?shipBody.thrust(400):this._cursors.down.isDown&&shipBody.reverse(400)},MoveBullets:function(bullet){this.AccelerateToObject(bullet,this._ship,30)},AccelerateToObject:function(obj1,obj2,speed){isNaN(speed)&&(speed=60);var obj1Body=obj1.body,angle=Math.atan2(obj2.y-obj1.y,obj2.x-obj1.x);obj1Body.rotation=angle+Math.PI/2;obj1Body.force.x=Math.cos(angle)*speed;obj1Body.force.y=Math.sin(angle)*speed}}});Bridge.define("PhaserDemo.Games.GameState3",{inherits:[PhaserDemo.Games.AbstractGameState],methods:{preload:function(){this.game.load.crossOrigin=!0;this.game.load.image("einstein","https://raw.githubusercontent.com/photonstorm/phaser-examples/master/examples/assets/pics/ra_einstein.png")},create:function(){var image=this.game.add.sprite(0,0,"einstein"),imageBody;this.game.physics.enable(image,Phaser.Physics.ARCADE);imageBody=image.body;imageBody.velocity.x=150}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJQaGFzZXJEZW1vLm1pbi5qcyIsCiAgInNvdXJjZVJvb3QiOiAiIiwKICAic291cmNlcyI6IFtdLAogICJuYW1lcyI6IFtdLAogICJtYXBwaW5ncyI6ICIiLAogICJzb3VyY2VzQ29udGVudCI6IFtdCn0K
